# --- Cáº¥u hÃ¬nh Project ---
PKG_NAME      := com.mycompany.app
# Láº¥y pháº§n cha (com.mycompany) Ä‘á»ƒ táº¡o package song song
PKG_PARENT    := com.mycompany
PKG_DIR       := $(subst .,/,$(PKG_PARENT))
MAIN_CLASS    := $(PKG_NAME).App
SRC_BASE      := src/main/java
# Trá» Ä‘áº¿n thÆ° má»¥c cha Ä‘á»ƒ p=model sáº½ táº¡o com/mycompany/model
FULL_PKG_PATH := $(SRC_BASE)/$(PKG_DIR)

# --- MÃ u sáº¯c ---
BLUE   := \033[1;34m
GREEN  := \033[1;32m
CYAN   := \033[1;36m
YELLOW := \033[1;33m
RED    := \033[1;31m
RESET  := \033[0m

# --- Lá»‡nh thá»±c thi ---
run:
	@echo "$(CYAN)ðŸš€ Äang khá»Ÿi cháº¡y á»©ng dá»¥ng...$(RESET)"
	@mvn -q compile exec:java -Dexec.mainClass="$(MAIN_CLASS)"

debug:
	@echo "$(CYAN)ðŸ›   Äang cháº¡y cháº¿ Ä‘á»™ Debug...$(RESET)"
	@mvn -q compile
	@java -cp target/classes $(MAIN_CLASS)

# Táº¡o package song song: make create-pkg p=model -> com.mycompany.model
create-pkg:
	@mkdir -p $(FULL_PKG_PATH)/$(p)
	@echo "$(GREEN)âœ”$(RESET) ÄÃ£ táº¡o package: $(YELLOW)$(PKG_PARENT).$(p)$(RESET)"

# Táº¡o class: make create-class n=User p=model
create-class:
	@$(eval FINAL_PATH := $(if $(p),$(FULL_PKG_PATH)/$(p),$(FULL_PKG_PATH)/app))
	@$(eval FINAL_PKG := $(if $(p),$(PKG_PARENT).$(p),$(PKG_NAME)))
	@mkdir -p $(FINAL_PATH)
	@printf "package $(FINAL_PKG);\n\npublic class $(n) {\n    public $(n)() {\n        System.out.println(\"Khá»Ÿi táº¡o $(n) thÃ nh cÃ´ng!\");\n    }\n}\n" > $(FINAL_PATH)/$(n).java
	@echo "$(GREEN)âœ”$(RESET) ÄÃ£ táº¡o class $(YELLOW)$(n)$(RESET) táº¡i $(CYAN)$(FINAL_PKG)$(RESET)"

clean:
	@mvn clean
	@echo "$(YELLOW)âœ” ÄÃ£ dá»n dáº¹p thÆ° má»¥c target$(RESET)"

compress:
	@mvn package -DskipTests
	@echo "$(GREEN)âœ” ÄÃ£ táº¡o file JAR táº¡i target/$(RESET)"

status:
	@echo "$(BLUE)==========================================$(RESET)"
	@echo "$(CYAN)          PROJECT STATUS REPORT          $(RESET)"
	@echo "$(BLUE)==========================================$(RESET)"
	@echo "$(GREEN)â–¶ Maven Version:$(RESET)  $$(mvn --version | head -n 1)"
	@echo "$(GREEN)â–¶ Entry Point:$(RESET)    $(YELLOW)$(MAIN_CLASS)$(RESET)"
	@echo "$(GREEN)â–¶ Artifact Size:$(RESET)  $(YELLOW)$$(du -sh target/ 2>/dev/null | cut -f1 || echo "Empty")$(RESET)"
	@echo "$(GREEN)â–¶ Source Files:$(RESET)   $(YELLOW)$$(find src/main/java -name "*.java" | wc -l)$(RESET) files"
	@echo "$(GREEN)â–¶ Current Time:$(RESET)   $$(date '+%Y-%m-%d %H:%M:%S')"
	@echo "$(BLUE)==========================================$(RESET)"

help:
	@echo "$(CYAN)CÃ¡c lá»‡nh há»— trá»£:$(RESET)"
	@echo "  $(GREEN)make run$(RESET)             : BiÃªn dá»‹ch vÃ  cháº¡y"
	@echo "  $(GREEN)make create-pkg p=$(RESET)   : Táº¡o package má»›i (vd: p=model)"
	@echo "  $(GREEN)make create-class n= p=$(RESET): Táº¡o class má»›i (vd: n=User p=model)"
	@echo "  $(GREEN)make status$(RESET)          : Xem tá»•ng quan dá»± Ã¡n"
	@echo "  $(GREEN)make clean$(RESET)           : XÃ³a rÃ¡c biÃªn dá»‹ch"

.PHONY: all run debug create-pkg create-class clean compress status help
